let forms=document.querySelectorAll("form");function waitForGenesysReady(e,s=30,n=100){(()=>{try{if("function"==typeof window.Genesys&&window.Genesys("subscribe"))return void e()}catch(e){}s>0?setTimeout((()=>waitForGenesysReady(e,s-1,n)),n):console.warn("Genesys not available after waiting.")})()}forms.forEach((function(e){e.addEventListener("click",(function s(){dataLayer.push({event:"formEngagement"}),e.removeEventListener("click",s)}))})),console.log("Waiting for Genesys..."),waitForGenesysReady((()=>{console.log("Genesys is ready, subscribing to events..."),Genesys("subscribe","Conversations.started",(function(){dataLayer.push({event:"chatOpen"})})),Genesys("subscribe","MessagingService.messagesReceived",(function({data:e}){console.debug("Received message data:",e);const s=e?.messages?.[0]?.text,n=window.location.hostname,a=n.includes(".co.nz")||n.includes("peninsula-anz-nz"),t=n.includes(".com.au")||n.includes("peninsula-anz-au"),i=s?.match(/[a-zA-Z0-9_.-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/);i&&dataLayer.push({event:"chatEmailCapture",email:i});const o=s?.match(/(\+?\d{1,3})?[\s\-]?\(?\d+\)?[\s\-]?\d+[\s\-]?\d+/);if(o){let e=o[0].replace(/[^\d+]/g,""),s="";e.startsWith("0")?t?(e="+61"+e.slice(1),s="AU"):a&&(e="+64"+e.slice(1),s="NZ"):e.startsWith("+")||(t?(e="+61"+e,s="AU"):a&&(e="+64"+e,s="NZ")),dataLayer.push({event:"chatPhoneCapture",hostname:n,phoneNumber:e,country:s})}}))}));